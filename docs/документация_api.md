# Документация по API Бэкенда

Этот документ описывает все API-маршруты (endpoints), используемые в приложении "АвтомойкаПро". Бэкенд построен на базе Next.js API Routes и работает с данными, хранящимися в JSON-файлах в директории `/data`.

## 1. Общие принципы

-   **Формат данных**: Все запросы и ответы используют формат JSON.
-   **Идентификация**: Большинство сущностей идентифицируются по уникальному `id`.
-   **Структура URL**: URL-адреса строятся по принципу REST, например `/api/employees` для списка сотрудников и `/api/employees/{id}` для конкретного сотрудника.
-   **Обработка ошибок**: В случае ошибки сервер возвращает JSON-объект с полем `error` и соответствующий HTTP-статус (например, 404 для "не найдено", 500 для "внутренняя ошибка сервера").

---

## 2. Агрегаторы (`/api/aggregators`)

### `GET /api/aggregators`
-   **Описание**: Получает список всех агрегаторов.
-   **Ответ**: `Aggregator[]` — массив объектов агрегаторов.

### `GET /api/aggregators/{id}`
-   **Описание**: Получает одного агрегатора по его `id`.
-   **Ответ**: `Aggregator` — объект агрегатора.

### `PUT /api/aggregators/{id}`
-   **Описание**: Обновляет существующего или создает нового агрегатора. Если файл с таким `id` существует, он будет перезаписан. Если нет — создан. **Важно:** При обновлении, если в теле запроса не передан `balance`, будет сохранено текущее значение из файла, чтобы избежать случайной перезаписи.
-   **Тело запроса**: `Aggregator` — полный объект агрегатора для сохранения.
-   **Ответ**: Сообщение об успехе и обновленный объект.

### `DELETE /api/aggregators/{id}`
-   **Описание**: Удаляет агрегатора по его `id`.
-   **Ответ**: Сообщение об успехе.

---

## 3. Контрагенты (`/api/counter-agents`)

### `GET /api/counter-agents`
-   **Описание**: Получает список всех контрагентов.
-   **Ответ**: `CounterAgent[]` — массив объектов контрагентов.

### `GET /api/counter-agents/{id}`
-   **Описание**: Получает одного контрагента по его `id`.
-   **Ответ**: `CounterAgent` — объект контрагента.

### `PUT /api/counter-agents/{id}`
-   **Описание**: Обновляет существующего или создает нового контрагента.
-   **Тело запроса**: `CounterAgent` — полный объект контрагента для сохранения.
-   **Ответ**: Сообщение об успехе и обновленный объект.

### `DELETE /api/counter-agents/{id}`
-   **Описание**: Удаляет контрагента по его `id`.
-   **Ответ**: Сообщение об успехе.

---

## 4. Транзакции клиентов (`/api/client-transactions`)

### `POST /api/client-transactions/{clientId}`
-   **Описание**: Добавляет новую финансовую операцию (платеж) для контрагента или агрегатора.
-   **Тело запроса**: `{ amount: number, description: string }`.
-   **Ответ**: Сообщение об успехе и созданный объект транзакции `ClientTransaction`.

### `DELETE /api/client-transactions/{clientId}?transactionId={transactionId}`
-   **Описание**: Удаляет финансовую операцию (платеж) по ее `transactionId`. При удалении баланс клиента автоматически пересчитывается.
-   **Ответ**: Сообщение об успехе.

---

## 5. Сотрудники (`/api/employees`)

### `GET /api/employees`
-   **Описание**: Получает список всех сотрудников.
-   **Ответ**: `Employee[]` — массив объектов сотрудников.

### `POST /api/employees`
-   **Описание**: Создает нового сотрудника. ID должен быть предоставлен в теле запроса.
-   **Тело запроса**: `Employee` — объект нового сотрудника.
-   **Ответ**: Сообщение об успехе и созданный объект.

### `GET /api/employees/{id}`
-   **Описание**: Получает одного сотрудника по его `id`.
-   **Ответ**: `Employee` — объект сотрудника.

### `PUT /api/employees/{id}`
-   **Описание**: Обновляет данные существующего сотрудника.
-   **Тело запроса**: `Employee` — полный объект сотрудника для сохранения.
-   **Ответ**: Сообщение об успехе и обновленный объект.

### `DELETE /api/employees/{id}`
-   **Описание**: Удаляет сотрудника по его `id`.
-   **Ответ**: Сообщение об успехе.

### `POST /api/employees/{id}/transactions`
-   **Описание**: Добавляет новую финансовую операцию (выплата, долг, бонус) для конкретного сотрудника.
-   **Тело запроса**: `{ type: EmployeeTransactionType, amount: number, description: string }`.
-   **Ответ**: Сообщение об успехе и созданный объект транзакции `EmployeeTransaction`.

### `DELETE /api/employees/{id}/transactions?transactionId={transactionId}`
-   **Описание**: Удаляет финансовую операцию сотрудника.
-   **Ответ**: Сообщение об успехе.

---

## 6. Розничный прайс-лист (`/api/retail-price-list`)

### `GET /api/retail-price-list`
-   **Описание**: Получает конфигурацию розничного прайс-листа.
-   **Ответ**: `RetailPriceConfig`.

### `POST /api/retail-price-list`
-   **Описание**: Обновляет конфигурацию розничного прайс-листа.
-   **Тело запроса**: `RetailPriceConfig`.
-   **Ответ**: Сообщение об успехе.

---

## 7. Схемы зарплат (`/api/salary-schemes`)

### `GET /api/salary-schemes`
-   **Описание**: Получает список всех схем зарплат.
-   **Ответ**: `SalaryScheme[]`.

### `POST /api/salary-schemes`
-   **Описание**: Создает новую схему зарплаты.
-   **Тело запроса**: `SalaryScheme`.
-   **Ответ**: Сообщение об успехе.

### `GET /api/salary-schemes/{id}`
-   **Описание**: Получает одну схему по `id`.
-   **Ответ**: `SalaryScheme`.

### `PUT /api/salary-schemes/{id}`
-   **Описание**: Обновляет существующую схему.
-   **Тело запроса**: `SalaryScheme`.
-   **Ответ**: Сообщение об успехе.

### `DELETE /api/salary-schemes/{id}`
-   **Описание**: Удаляет схему по `id`.
-   **Ответ**: Сообщение об успехе.

---

## 8. Журнал моек (`/api/wash-events`)

### `GET /api/wash-events`
-   **Описание**: Получает список всех событий моек.
-   **Ответ**: `WashEvent[]`.

### `POST /api/wash-events`
-   **Описание**: Создает новую запись о мойке.
-   **Тело запроса**: `WashEvent`.
-   **Ответ**: Сообщение об успехе.

### `GET /api/wash-events/{id}`
-   **Описание**: Получает одну запись о мойке по `id`.
-   **Ответ**: `WashEvent`.

### `PUT /api/wash-events/{id}`
-   **Описание**: Обновляет существующую запись о мойке.
-   **Тело запроса**: `WashEvent`.
-   **Ответ**: Сообщение об успехе.

### `DELETE /api/wash-events/{id}`
-   **Описание**: Удаляет запись о мойке по `id`.
-   **Ответ**: Сообщение об успехе.
